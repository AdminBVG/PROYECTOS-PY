{% extends "base.html" %}
{% block title %}Panel Asistencia{% endblock %}
{% block content %}
<header class="header">
  <h1>Panel de Asistencia</h1>
  <a class="logout" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Cerrar sesión</a>
</header>
<div class="card">
  <h2>Votaciones asignadas</h2>
  <select id="votacionSelect">
    {% for v in votaciones %}
      <option value="{{ v['id'] }}">{{ v['nombre'] }}</option>
    {% endfor %}
  </select>
</div>
<div class="card">
  <h2>Control de asistencia</h2>
  <div id="clock"></div>

  {% if not readonly %}
  <div class="import">
    <input type="file" id="fileInput" accept=".xlsx,.xls">
    <button id="uploadBtn">Importar</button>
  </div>
  {% endif %}
  <button id="templateBtn">Exportar plantilla de asistencia</button>

  <div class="filters">
    <input id="search" placeholder="Buscar por nombre">
    <select id="filterEstado">
      <option value="">Todos</option>
      <option value="PRESENCIAL">Presencial</option>
      <option value="VIRTUAL">Virtual</option>
      <option value="AUSENTE">Ausente</option>
    </select>
    <label>Quórum mínimo: <input type="number" id="quorum" value="0" readonly></label>
  </div>

  <div class="actions">
    {% if not readonly %}
    <button id="markAll">PRESENCIAL</button>
    <button id="markVirtual">VIRTUAL</button>
    <button id="clearAll">AUSENTE</button>
    <button id="save">Guardar</button>
    {% endif %}
    <button id="exportExcel">Exportar Excel</button>
    <button id="exportCsv">Exportar CSV</button>
    <button id="exportPdf">Exportar PDF</button>
  </div>

  <div class="charts">
    <canvas id="pieChart" width="300" height="300"></canvas>
    <canvas id="barChart" width="300" height="300"></canvas>
  </div>

  <table id="tablaAsistencia">
    <thead>
      <tr>
        <th>Accionista</th>
        <th>Representante</th>
        <th>Apoderado</th>
        <th>Acciones</th>
        <th>Estado</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="summary"></div>
</div>
<script>
  const READONLY = {{ 'true' if readonly else 'false' }};
</script>
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/asistencia.js') }}"></script>
{% endblock %}
